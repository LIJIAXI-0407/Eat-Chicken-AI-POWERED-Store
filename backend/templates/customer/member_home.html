<!-- templates/customer/member_home.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>会员首页</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center mb-4">欢迎，{{ member.name }}！</h2>
        <p class="text-center">手机号：<strong>{{ member.phone }}</strong></p>
        <p class="text-center">当前积分：<strong class="text-primary" id="currentPoints">{{ member.points }}</strong></p>

        <div class="card mt-4">
            <div class="card-header bg-secondary text-white">可兑换商品</div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    🎁 12个鸡蛋 - 100积分
                    <button class="btn btn-outline-primary btn-sm" onclick="redeem(1, 100)">兑换</button>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    🥩 三公斤羊肉 - 500积分
                    <button class="btn btn-outline-primary btn-sm" onclick="redeem(1, 500)">兑换</button>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    📱 老年机 - 2000积分
                    <button class="btn btn-outline-primary btn-sm" onclick="redeem(1, 2000)">兑换</button>
                </li>
            </ul>
        </div>

        <div class="text-center mt-4">
            <a href="/customer/points" class="btn btn-success me-2">查看兑换记录</a>
            <a href="/" class="btn btn-outline-secondary">返回首页</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function redeem(boxes, pointsRequired) {
            const phone = "{{ member.phone }}";
            fetch('/customer/api/redeem', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone: phone, boxes: boxes, points: pointsRequired })
            })
            .then(res => res.json())
            .then(data => {
                Swal.fire(data.message, '', data.success ? 'success' : 'error');
                if (data.success) {
                    const currentPoints = document.getElementById("currentPoints");
                    const updated = parseInt(currentPoints.textContent) - pointsRequired;
                    currentPoints.textContent = updated;
                }
            })
            .catch(() => Swal.fire('兑换失败，请稍后再试', '', 'error'));
        }
    </script>
</body>
</html>